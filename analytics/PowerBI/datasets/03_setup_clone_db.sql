USE ROLE ACCOUNTADMIN;

CREATE DATABASE IF NOT EXISTS TASTY_BYTES_CLONE CLONE TASTY_BYTES;

-- Give SYSADMIN ownership so your platform admin role can manage it
GRANT OWNERSHIP ON DATABASE TASTY_BYTES_CLONE TO ROLE SYSADMIN REVOKE CURRENT GRANTS;

-- Switch to SYSADMIN to create schema
USE ROLE SYSADMIN;
USE DATABASE TASTY_BYTES_CLONE;
CREATE SCHEMA IF NOT EXISTS ANALYTICS;

-- Now grant usage/privs to project roles
USE ROLE SECURITYADMIN;

GRANT USAGE ON DATABASE TASTY_BYTES_CLONE TO ROLE ANALYTICS_DEV_ROLE, POWERBI_READ_ROLE;
GRANT USAGE ON SCHEMA   TASTY_BYTES_CLONE.RAW_POS   TO ROLE ANALYTICS_DEV_ROLE;
GRANT USAGE ON SCHEMA   TASTY_BYTES_CLONE.ANALYTICS TO ROLE ANALYTICS_DEV_ROLE, POWERBI_READ_ROLE;

GRANT CREATE VIEW ON SCHEMA TASTY_BYTES_CLONE.ANALYTICS TO ROLE ANALYTICS_DEV_ROLE;

GRANT SELECT ON ALL TABLES  IN SCHEMA TASTY_BYTES_CLONE.RAW_POS TO ROLE ANALYTICS_DEV_ROLE;
GRANT SELECT ON FUTURE TABLES IN SCHEMA TASTY_BYTES_CLONE.RAW_POS TO ROLE ANALYTICS_DEV_ROLE;

GRANT SELECT ON ALL VIEWS   IN SCHEMA TASTY_BYTES_CLONE.ANALYTICS TO ROLE POWERBI_READ_ROLE;
GRANT SELECT ON FUTURE VIEWS IN SCHEMA TASTY_BYTES_CLONE.ANALYTICS TO ROLE POWERBI_READ_ROLE;
